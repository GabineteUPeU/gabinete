<!DOCTYPE html>
<html lang="es" x-data="app()" :class="{ dark: darkMode }" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gabinete PedagÃ³gico â€” UPeU</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { upeu: { blue:'#1a3a6b', light:'#2451a0', gold:'#c8a94a' } } } }
    }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <!-- App JS (deben cargarse antes de Alpine) -->
  <script src="js/firebase.js"></script>
  <script src="js/helpers.js"></script>
  <script src="js/ciclos.js"></script>
  <script src="js/secciones.js"></script>
  <script src="js/recursos.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/app.js"></script>

  <!-- Alpine.js (diferido: se ejecuta despuÃ©s de los scripts anteriores) -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="h-full overflow-hidden bg-slate-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">

<!-- BARRA DE PROGRESO -->
<div class="progress-bar" :style="`width:${progress}%`"></div>

<!-- PANTALLA: Firebase no configurado -->
<div x-show="configSinLlenar" x-cloak
  class="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/95 backdrop-blur-sm">
  <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl w-full max-w-lg p-8 text-center">
    <div class="text-6xl mb-4">ğŸ”¥</div>
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Configura Firebase</h2>
    <p class="text-gray-500 dark:text-gray-400 text-sm mb-6 leading-relaxed">
      Para guardar los datos en la nube necesitas conectar Firebase Realtime Database.
      Sigue los pasos y luego pega tu configuraciÃ³n en <code class="bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-xs">js/firebase.js</code>.
    </p>
    <div class="text-left bg-gray-50 dark:bg-gray-900 rounded-2xl p-5 mb-6 space-y-3">
      <p class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2">Pasos rÃ¡pidos</p>
      <div class="flex gap-3 text-sm">
        <span class="w-6 h-6 rounded-full bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400 flex items-center justify-center text-xs font-bold flex-shrink-0">1</span>
        <span class="text-gray-700 dark:text-gray-300">Ir a <strong>console.firebase.google.com</strong> y crear un proyecto nuevo</span>
      </div>
      <div class="flex gap-3 text-sm">
        <span class="w-6 h-6 rounded-full bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400 flex items-center justify-center text-xs font-bold flex-shrink-0">2</span>
        <span class="text-gray-700 dark:text-gray-300">En el proyecto â†’ <strong>Build â†’ Realtime Database</strong> â†’ Crear base de datos â†’ <em>Modo de prueba</em></span>
      </div>
      <div class="flex gap-3 text-sm">
        <span class="w-6 h-6 rounded-full bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400 flex items-center justify-center text-xs font-bold flex-shrink-0">3</span>
        <span class="text-gray-700 dark:text-gray-300">Ir a <strong>ConfiguraciÃ³n âš™ï¸ â†’ Tus apps â†’ Agregar app web</strong> â†’ Copiar el objeto <code class="bg-gray-200 dark:bg-gray-700 px-1 rounded text-xs">firebaseConfig</code></span>
      </div>
      <div class="flex gap-3 text-sm">
        <span class="w-6 h-6 rounded-full bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400 flex items-center justify-center text-xs font-bold flex-shrink-0">4</span>
        <span class="text-gray-700 dark:text-gray-300">Pegar los valores en <code class="bg-gray-200 dark:bg-gray-700 px-1 rounded text-xs">js/firebase.js</code></span>
      </div>
    </div>
    <div class="flex gap-3 justify-center">
      <button @click="configSinLlenar=false" class="btn-ghost border border-gray-200 dark:border-gray-600 text-sm">
        Usar sin Firebase (local)
      </button>
      <a href="https://console.firebase.google.com" target="_blank" class="btn-primary text-sm flex items-center gap-2">
        <span>ğŸ”¥</span> Ir a Firebase Console
      </a>
    </div>
  </div>
</div>

<!-- TOASTS -->
<div id="toast-container">
  <template x-for="t in toasts" :key="t.id">
    <div :class="'toast toast-' + t.tipo" x-text="t.msg"></div>
  </template>
</div>

<!-- OVERLAY MOBILE -->
<div id="sidebarOverlay" @click="sidebarOpen=false" :class="{'show':sidebarOpen}"></div>

<!-- ==================== MODALES ==================== -->

<!-- Modal: Nuevo Ciclo -->
<div x-show="modal.ciclo" x-cloak class="modal-overlay" @click.self="modal.ciclo=false"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
  <div class="modal-box p-6">
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
        <span class="text-2xl">ğŸ“†</span> Nuevo Ciclo AcadÃ©mico
      </h3>
      <button @click="modal.ciclo=false" class="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="space-y-4">
      <div>
        <label class="form-label">Nombre del ciclo *</label>
        <input x-model="formCiclo.nombre" @keyup.enter="guardarCiclo()" type="text"
          placeholder="Ej: 2026-1" class="form-input" maxlength="20" />
        <p class="text-xs text-gray-400 mt-1">Formato sugerido: YYYY-N (ej: 2026-1, 2026-2)</p>
      </div>
    </div>
    <div class="flex gap-3 mt-6 justify-end">
      <button @click="modal.ciclo=false" class="btn-ghost">Cancelar</button>
      <button @click="guardarCiclo()" class="btn-primary">Crear Ciclo</button>
    </div>
  </div>
</div>

<!-- Modal: Nueva SecciÃ³n -->
<div x-show="modal.seccion" x-cloak class="modal-overlay" @click.self="modal.seccion=false"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
  <div class="modal-box p-6">
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
        <span class="text-2xl">ğŸ“</span> Nueva SecciÃ³n / Ãrea
      </h3>
      <button @click="modal.seccion=false" class="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="space-y-4">
      <div>
        <label class="form-label">Nombre del Ã¡rea *</label>
        <input x-model="formSeccion.nombre" type="text" placeholder="Ej: Monitoreo Docente" class="form-input" />
      </div>
      <div>
        <label class="form-label">DescripciÃ³n</label>
        <input x-model="formSeccion.descripcion" type="text" placeholder="Breve descripciÃ³n del Ã¡rea" class="form-input" />
      </div>
      <div>
        <label class="form-label">Ãcono</label>
        <div class="emoji-grid mt-1 p-3 bg-gray-50 dark:bg-gray-900 rounded-xl">
          <template x-for="e in emojis" :key="e">
            <button type="button" @click="formSeccion.icono=e"
              :class="formSeccion.icono===e ? 'emoji-btn sel' : 'emoji-btn'" x-text="e"></button>
          </template>
        </div>
      </div>
      <div>
        <label class="form-label">Color</label>
        <div class="color-pick mt-1">
          <template x-for="c in colores" :key="c">
            <button type="button" @click="formSeccion.color=c"
              :class="'color-dot color-dot-'+c+(formSeccion.color===c?' sel':'')"></button>
          </template>
        </div>
      </div>
    </div>
    <div class="flex gap-3 mt-6 justify-end">
      <button @click="modal.seccion=false" class="btn-ghost">Cancelar</button>
      <button @click="guardarSeccion()" class="btn-primary">Crear SecciÃ³n</button>
    </div>
  </div>
</div>

<!-- Modal: Nuevo / Editar Recurso -->
<div x-show="modal.recurso" x-cloak class="modal-overlay" @click.self="modal.recurso=false"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
  <div class="modal-box p-6 max-w-lg">
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
        <span class="text-2xl" x-text="editingRecurso ? 'âœï¸' : 'ğŸ”—'"></span>
        <span x-text="editingRecurso ? 'Editar Recurso' : 'Nuevo Recurso'"></span>
      </h3>
      <button @click="modal.recurso=false" class="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="space-y-4">
      <div>
        <label class="form-label">TÃ­tulo *</label>
        <input x-model="formRecurso.titulo" type="text" placeholder="Ej: Horarios de Clase 2026-1" class="form-input" />
      </div>
      <div>
        <label class="form-label">DescripciÃ³n</label>
        <input x-model="formRecurso.descripcion" type="text" placeholder="Breve descripciÃ³n del recurso" class="form-input" />
      </div>
      <div>
        <label class="form-label">URL / Link *</label>
        <input x-model="formRecurso.link" type="url" placeholder="https://..." class="form-input" />
        <p class="text-xs text-gray-400 mt-1">Puede ser un link de SharePoint, Google Drive, Formulario, etc.</p>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="form-label">Tipo</label>
          <select x-model="formRecurso.tipo" class="form-input">
            <option value="documento">ğŸ“„ Documento</option>
            <option value="formulario">ğŸ“ Formulario</option>
            <option value="evento">ğŸ“ Evento</option>
            <option value="sistema">ğŸ’» Sistema</option>
            <option value="recurso">ğŸ—‚ï¸ Recurso</option>
          </select>
        </div>
        <div>
          <label class="form-label">Fecha</label>
          <input x-model="formRecurso.fecha" type="date" class="form-input" />
        </div>
      </div>
    </div>
    <div class="flex gap-3 mt-6 justify-end">
      <button @click="modal.recurso=false" class="btn-ghost">Cancelar</button>
      <button @click="guardarRecurso()" class="btn-primary"
        x-text="editingRecurso ? 'Guardar Cambios' : 'Agregar Recurso'"></button>
    </div>
  </div>
</div>

<!-- Modal: Confirmar EliminaciÃ³n -->
<div x-show="modal.confirmar" x-cloak class="modal-overlay" @click.self="modal.confirmar=false"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
  <div class="modal-box p-6 max-w-sm text-center">
    <div class="w-14 h-14 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">ğŸ—‘ï¸</div>
    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2"
      x-text="'Eliminar ' + (confirmData.tipo || 'elemento')"></h3>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
      Â¿EstÃ¡s seguro? Esta acciÃ³n no se puede deshacer.
      <strong class="block mt-1 text-gray-700 dark:text-gray-300" x-text="confirmData.nombre"></strong>
    </p>
    <div class="flex gap-3 justify-center">
      <button @click="modal.confirmar=false" class="btn-ghost">Cancelar</button>
      <button @click="confirmData.fn(); modal.confirmar=false" class="btn-danger">Eliminar</button>
    </div>
  </div>
</div>

<!-- ==================== LAYOUT ==================== -->
<div class="flex h-full overflow-hidden">

  <!-- SIDEBAR -->
  <aside id="sidebar" :class="{'open':sidebarOpen}"
    class="w-64 flex-shrink-0 flex flex-col h-full overflow-hidden bg-upeu-blue dark:bg-gray-800 text-white shadow-2xl md:static md:translate-x-0">

    <!-- Branding -->
    <div class="header-gradient px-5 py-4 flex-shrink-0 border-b border-white/10">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center font-bold text-upeu-gold text-sm">GP</div>
        <div>
          <h1 class="text-sm font-bold leading-tight">Gabinete PedagÃ³gico</h1>
          <p class="text-xs text-white/50 mt-0.5">UPeU Â· FCHE</p>
        </div>
      </div>
    </div>

    <!-- NavegaciÃ³n -->
    <div class="flex-1 overflow-y-auto py-3 px-2.5 space-y-0.5">

      <!-- Inicio -->
      <button @click="setVista('inicio'); sidebarOpen=false"
        :class="vistaActiva==='inicio' ? 'nav-item active' : 'nav-item'"
        class="w-full text-left px-3 py-2.5 rounded-lg text-sm flex items-center gap-2.5">
        <span class="text-base w-5 text-center">ğŸ </span>
        <span>Inicio</span>
      </button>

      <!-- Dashboard -->
      <button @click="setVista('dashboard'); sidebarOpen=false"
        :class="vistaActiva==='dashboard' ? 'nav-item active' : 'nav-item'"
        class="w-full text-left px-3 py-2.5 rounded-lg text-sm flex items-center gap-2.5">
        <span class="text-base w-5 text-center">ğŸ“Š</span>
        <span>Dashboard</span>
      </button>

      <!-- Ciclos -->
      <div class="pt-4">
        <div class="flex items-center justify-between px-3 mb-2">
          <p class="text-xs font-semibold text-white/35 uppercase tracking-widest">Ciclos</p>
          <button @click="abrirModalCiclo()" title="Agregar ciclo"
            class="w-5 h-5 rounded-md bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors text-white/60 hover:text-white text-xs font-bold">+</button>
        </div>
        <template x-for="sem in data.semestres" :key="sem">
          <div class="relative group/sem">
            <button @click="setSemestre(sem); sidebarOpen=false"
              :class="semestreActivo===sem ? 'bg-white/10 border-l-2 border-upeu-gold' : ''"
              class="nav-item w-full text-left px-3 py-2.5 rounded-lg text-sm flex items-center gap-2.5">
              <span class="text-base w-5 text-center">ğŸ“†</span>
              <span x-text="sem" class="flex-1"></span>
              <span x-show="semestreActivo===sem" class="text-xs text-upeu-gold bg-white/10 px-1.5 py-0.5 rounded-md">activo</span>
            </button>
            <button x-show="data.semestres.length > 1 && semestreActivo !== sem"
              @click="confirmarEliminar('Ciclo', sem, () => eliminarCiclo(sem))"
              class="absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover/sem:opacity-100
                     w-5 h-5 rounded bg-white/10 hover:bg-red-500/30 flex items-center justify-center
                     transition-all text-white/50 hover:text-red-300 text-xs">âœ•</button>
          </div>
        </template>
      </div>

      <!-- Secciones -->
      <div class="pt-4">
        <div class="flex items-center justify-between px-3 mb-2">
          <p class="text-xs font-semibold text-white/35 uppercase tracking-widest">Secciones</p>
          <button @click="abrirModalSeccion()" title="Agregar secciÃ³n"
            class="w-5 h-5 rounded-md bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors text-white/60 hover:text-white text-xs font-bold">+</button>
        </div>
        <template x-for="sec in seccionesActivas()" :key="sec.id">
          <div class="relative group/sec">
            <button @click="setVista(sec.id); sidebarOpen=false"
              :class="vistaActiva===sec.id ? 'nav-item active' : 'nav-item'"
              class="w-full text-left px-3 py-2.5 rounded-lg text-sm flex items-center gap-2.5 pr-10">
              <span x-text="sec.icono" class="text-base w-5 text-center"></span>
              <span x-text="sec.nombre" class="flex-1 text-left leading-tight truncate"></span>
              <span x-text="(sec.items || []).length" class="text-xs bg-white/10 text-white/60 px-1.5 py-0.5 rounded-md flex-shrink-0"></span>
            </button>
            <button @click="confirmarEliminar('SecciÃ³n', sec.nombre, () => eliminarSeccion(sec.id))"
              class="absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover/sec:opacity-100
                     w-5 h-5 rounded bg-white/10 hover:bg-red-500/30 flex items-center justify-center
                     transition-all text-white/50 hover:text-red-300 text-xs">âœ•</button>
          </div>
        </template>
        <div x-show="seccionesActivas().length === 0" class="px-3 py-4 text-center text-xs text-white/30">
          Sin secciones. Presiona + para agregar.
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="flex-shrink-0 border-t border-white/10 p-3">
      <div class="flex items-center gap-2 px-3 py-2 rounded-lg"
        :class="firebaseOk ? 'bg-emerald-900/30' : 'bg-white/5'">
        <span class="relative flex h-2.5 w-2.5 flex-shrink-0">
          <span x-show="firebaseOk" class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5"
            :class="firebaseOk ? 'bg-emerald-400' : 'bg-gray-500'"></span>
        </span>
        <span class="text-xs" :class="firebaseOk ? 'text-emerald-400' : 'text-white/40'"
          x-text="firebaseOk ? 'Firebase conectado' : 'Modo local (sin Firebase)'"></span>
      </div>
      <p class="text-center text-xs text-white/20 pt-2">Â© 2026 UPeU Â· Gabinete PedagÃ³gico</p>
    </div>
  </aside>

  <!-- COLUMNA DERECHA -->
  <div class="flex-1 flex flex-col min-w-0 overflow-hidden">

    <!-- HEADER -->
    <header class="flex-shrink-0 header-gradient text-white px-5 py-3 flex items-center gap-4 shadow-lg z-20">
      <button @click="sidebarOpen=!sidebarOpen" class="md:hidden p-2 rounded-lg hover:bg-white/10 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>

      <!-- Breadcrumb -->
      <nav class="flex-1 min-w-0 flex items-center gap-1.5 text-sm">
        <button @click="setVista('inicio')" class="text-white/50 hover:text-white transition-colors truncate hidden sm:inline">Gabinete</button>
        <span class="text-white/30 hidden sm:inline">â€º</span>
        <span class="text-upeu-gold font-semibold" x-text="semestreActivo"></span>
        <template x-if="vistaActiva !== 'inicio'">
          <span class="text-white/30">â€º</span>
        </template>
        <span class="text-white font-medium truncate" x-text="tituloVista()"></span>
      </nav>

      <!-- BÃºsqueda -->
      <div class="relative hidden sm:block">
        <input x-model="busqueda" type="text" placeholder="Buscar..."
          class="w-44 bg-white/10 border border-white/20 text-white placeholder-white/40 text-sm rounded-xl px-4 py-1.5 pr-8 focus:bg-white/20 focus:outline-none focus:w-56 transition-all" />
        <svg class="w-3.5 h-3.5 absolute right-3 top-1/2 -translate-y-1/2 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z"/></svg>
      </div>

      <!-- Dark mode -->
      <button @click="darkMode=!darkMode" class="p-2 rounded-xl hover:bg-white/10 transition-colors"
        :title="darkMode ? 'Modo claro' : 'Modo oscuro'">
        <span x-text="darkMode ? 'â˜€ï¸' : 'ğŸŒ™'" class="text-lg leading-none"></span>
      </button>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 overflow-y-auto">

      <!-- ===== VISTA: DASHBOARD ===== -->
      <div x-show="vistaActiva==='dashboard'" class="p-5 md:p-7 page-enter"
           x-effect="if(vistaActiva==='dashboard') $nextTick(() => { initCharts(); fetchMonitoreoCSV(); })">

        <div class="mb-6">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white">Dashboard</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
            Resumen del ciclo <span class="font-semibold text-upeu-blue dark:text-blue-400" x-text="semestreActivo"></span>
          </p>
        </div>

        <!-- KPI cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-xl flex-shrink-0">ğŸ”—</div>
            <div>
              <p class="text-2xl font-bold text-upeu-blue dark:text-blue-400" x-text="dashboardData().totalRecursos"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Recursos</p>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-xl flex-shrink-0">ğŸ“</div>
            <div>
              <p class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="dashboardData().totalSecciones"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Secciones</p>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center text-xl flex-shrink-0">ğŸ“†</div>
            <div>
              <p class="text-2xl font-bold text-amber-600 dark:text-amber-400" x-text="dashboardData().totalSemestres"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Ciclos</p>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center text-xl flex-shrink-0">ğŸ†</div>
            <div>
              <p class="text-sm font-bold text-emerald-600 dark:text-emerald-400 capitalize" x-text="dashboardData().tipoMasComun"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Tipo frecuente</p>
            </div>
          </div>
        </div>

        <!-- â”€â”€ SecciÃ³n: Monitoreo Docente â”€â”€ -->
        <div class="mt-7 pt-6 border-t border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between mb-5">
            <div>
              <h3 class="text-base font-bold text-gray-800 dark:text-white flex items-center gap-2">
                <span class="text-lg">ğŸ‘ï¸</span> Monitoreo Docente
              </h3>
              <p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">Datos desde Google Sheets Â· pestaÃ±a Data</p>
            </div>
            <button @click="monitoreoData=null; fetchMonitoreoCSV()"
              :disabled="_monitoreoLoading"
              class="flex items-center gap-1.5 text-xs font-semibold text-upeu-blue dark:text-blue-400 hover:underline disabled:opacity-40 transition-opacity">
              <svg :class="_monitoreoLoading ? 'animate-spin' : ''" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582M20 20v-5h-.581M5.635 19A9 9 0 104.582 9H4"/>
              </svg>
              <span x-text="_monitoreoLoading ? 'Cargandoâ€¦' : 'Actualizar'"></span>
            </button>
          </div>

          <!-- Estado: cargando -->
          <div x-show="_monitoreoLoading"
            class="flex items-center justify-center gap-3 py-12 text-sm text-gray-400 dark:text-gray-500">
            <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"/>
            </svg>
            Cargando datos desde Google Sheetsâ€¦
          </div>

          <!-- Estado: error -->
          <div x-show="monitoreoData && monitoreoData.error && !_monitoreoLoading"
            class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-2xl p-5 text-center text-sm text-red-500 dark:text-red-400">
            No se pudo cargar los datos. Verifica que el Google Sheets estÃ© publicado pÃºblicamente.
          </div>

          <!-- Estado: sin datos aÃºn -->
          <div x-show="!monitoreoData && !_monitoreoLoading"
            class="bg-slate-50 dark:bg-gray-800/50 border border-dashed border-gray-200 dark:border-gray-700 rounded-2xl p-8 text-center text-sm text-gray-400 dark:text-gray-500">
            <span class="text-3xl block mb-2">ğŸ“Š</span>
            Presiona <strong>Actualizar</strong> o navega al dashboard para cargar los datos.
          </div>

          <!-- Datos cargados -->
          <div x-show="monitoreoData && !monitoreoData.error && !_monitoreoLoading">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">

              <!-- KPI: total monitoreados -->
              <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center">
                <div class="w-16 h-16 rounded-2xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center text-3xl mb-4">ğŸ‘©â€ğŸ«</div>
                <p class="text-5xl font-bold text-emerald-600 dark:text-emerald-400" x-text="monitoreoData?.total ?? 0"></p>
                <p class="text-sm font-semibold text-gray-500 dark:text-gray-400 mt-2">Total docentes<br>monitoreados</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Registros en hoja Data</p>
              </div>

              <!-- GrÃ¡fico: por monitor -->
              <div class="md:col-span-2 bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-100 dark:border-gray-700">
                <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Monitoreos por docente encargado</h4>
                <div style="position:relative;height:280px">
                  <canvas id="chartMonitores"></canvas>
                </div>
              </div>

            </div>
          </div>
        </div><!-- fin Monitoreo -->

      </div>

      <!-- ===== VISTA: INICIO ===== -->
      <div x-show="vistaActiva==='inicio'" class="p-5 md:p-7 page-enter">

        <!-- Banner -->
        <div class="header-gradient rounded-2xl p-6 md:p-8 mb-6 text-white relative overflow-hidden">
          <div class="absolute -top-10 -right-10 w-52 h-52 bg-white/5 rounded-full"></div>
          <div class="absolute -bottom-8 -left-8 w-36 h-36 bg-white/5 rounded-full"></div>
          <div class="relative">
            <p class="text-upeu-gold text-xs font-semibold uppercase tracking-widest mb-2">Universidad Peruana UniÃ³n</p>
            <h2 class="text-2xl md:text-3xl font-bold mb-1">Gabinete PedagÃ³gico</h2>
            <p class="text-white/70 text-sm">Facultad de Ciencias Humanas y EducaciÃ³n Â· Ciclo
              <span class="text-upeu-gold font-bold" x-text="semestreActivo"></span>
            </p>
          </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-7">
          <template x-for="stat in statsActivos()" :key="stat.label">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-3 card-resource">
              <div class="text-2xl" x-text="stat.icono"></div>
              <div>
                <p class="text-2xl font-bold text-upeu-blue dark:text-blue-400 stat-number" x-text="stat.valor"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400" x-text="stat.label"></p>
              </div>
            </div>
          </template>
        </div>

        <!-- Acceso rÃ¡pido -->
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Secciones del ciclo</h3>
          <button @click="abrirModalSeccion()"
            class="flex items-center gap-1.5 text-xs font-semibold text-upeu-blue dark:text-blue-400 hover:underline">
            <span class="text-base">+</span> Nueva secciÃ³n
          </button>
        </div>

        <div x-show="seccionesActivas().length === 0" class="empty-state">
          <div class="text-5xl mb-4">ğŸ“‚</div>
          <p class="font-semibold text-gray-600 dark:text-gray-400">Sin secciones en este ciclo</p>
          <p class="text-sm text-gray-400 mt-1 mb-4">Agrega una secciÃ³n para comenzar a organizar recursos</p>
          <button @click="abrirModalSeccion()" class="btn-primary">Agregar primera secciÃ³n</button>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <template x-for="sec in seccionesActivas()" :key="sec.id">
            <button @click="setVista(sec.id)" :class="'section-'+sec.color"
              class="card-resource ripple-container text-left bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-100 dark:border-gray-700 flex items-start gap-4 w-full group">
              <div :class="'icon-'+sec.color" class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                <span x-text="sec.icono"></span>
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="font-bold text-gray-900 dark:text-white group-hover:text-upeu-blue dark:group-hover:text-blue-400 transition-colors text-sm" x-text="sec.nombre"></h4>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 leading-relaxed line-clamp-2" x-text="sec.descripcion || 'Sin descripciÃ³n'"></p>
                <span class="inline-block mt-2 text-xs bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 px-2 py-0.5 rounded-lg"
                  x-text="(sec.items || []).length + ' recursos'"></span>
              </div>
              <svg class="w-4 h-4 text-gray-300 dark:text-gray-600 group-hover:text-upeu-blue dark:group-hover:text-blue-400 transition-all group-hover:translate-x-0.5 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </template>
        </div>
      </div>

      <!-- ===== VISTAS: SECCIONES ===== -->
      <template x-for="seccion in seccionesActivas()" :key="seccion.id">
        <div x-show="vistaActiva===seccion.id" class="p-5 md:p-7 page-enter">

          <!-- Header -->
          <div :class="'section-'+seccion.color"
            class="bg-white dark:bg-gray-800 rounded-2xl px-5 md:px-6 py-5 mb-5 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-wrap items-center gap-4">
            <div :class="'icon-'+seccion.color" class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl flex-shrink-0">
              <span x-text="seccion.icono"></span>
            </div>
            <div class="flex-1 min-w-0">
              <h2 class="text-lg font-bold text-gray-900 dark:text-white" x-text="seccion.nombre"></h2>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-0.5" x-text="seccion.descripcion || 'Sin descripciÃ³n'"></p>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
              <span class="text-sm bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 px-3 py-1.5 rounded-xl font-medium"
                x-text="(seccion.items || []).length + ' recursos'"></span>
              <button @click="abrirModalRecurso(seccion.id)"
                class="flex items-center gap-1.5 btn-primary text-xs px-3 py-1.5">
                <span class="text-sm font-bold">+</span> Agregar
              </button>
            </div>
          </div>

          <!-- BÃºsqueda mobile -->
          <div class="sm:hidden mb-4 relative">
            <input x-model="busqueda" type="text" placeholder="Buscar recurso..." class="form-input pr-9" />
            <svg class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z"/></svg>
          </div>

          <!-- Banner bÃºsqueda -->
          <div x-show="busqueda.length > 1" x-transition
            class="mb-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 text-amber-800 dark:text-amber-300 rounded-xl px-4 py-2.5 text-sm flex items-center gap-2">
            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z"/></svg>
            Filtrando por: <strong x-text="busqueda"></strong>
            <button @click="busqueda=''" class="ml-auto text-xs underline">Limpiar</button>
          </div>

          <!-- Grid recursos -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <template x-for="(item, idx) in itemsFiltrados(seccion)" :key="item.titulo + idx">
              <div class="card-resource bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col overflow-hidden group">
                <div :class="'h-1 bg-gradient-to-r ' + colorGradient(seccion.color)"></div>
                <div class="p-5 flex flex-col gap-3 flex-1">
                  <div class="flex items-center justify-between gap-2">
                    <span :class="'badge-'+item.tipo" class="text-xs px-2.5 py-1 rounded-lg font-medium flex-shrink-0" x-text="tipoLabel(item.tipo)"></span>
                    <span class="text-xs text-gray-400 dark:text-gray-500 truncate" x-text="formatFecha(item.fecha)"></span>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-sm font-bold text-gray-900 dark:text-white leading-snug" x-text="item.titulo"></h4>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1.5 leading-relaxed line-clamp-3" x-text="item.descripcion || ''"></p>
                  </div>
                  <div class="flex items-center justify-between pt-2 border-t border-gray-50 dark:border-gray-700 gap-2">
                    <a :href="item.link" target="_blank" rel="noopener"
                      :class="item.link && item.link !== '#' ? 'text-upeu-blue dark:text-blue-400 hover:underline' : 'text-gray-300 dark:text-gray-600 cursor-not-allowed'"
                      class="flex items-center gap-1.5 text-xs font-semibold transition-all">
                      <span x-text="item.link && item.link !== '#' ? 'Abrir recurso' : 'Sin link'"></span>
                      <svg x-show="item.link && item.link !== '#'" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                    </a>
                    <div class="admin-actions flex items-center gap-1">
                      <button @click.prevent="abrirEditarRecurso(seccion.id, item)" title="Editar"
                        class="p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-blue-900/40 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                      </button>
                      <button @click.prevent="confirmarEliminar('Recurso', item.titulo, () => eliminarRecurso(seccion.id, item.titulo))" title="Eliminar"
                        class="p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-red-100 dark:hover:bg-red-900/40 text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </template>

            <!-- Estado vacÃ­o -->
            <div x-show="itemsFiltrados(seccion).length === 0" class="col-span-full empty-state">
              <div class="text-5xl mb-3" x-text="busqueda.length > 1 ? 'ğŸ”' : 'ğŸ“­'"></div>
              <p class="font-semibold text-gray-600 dark:text-gray-400"
                x-text="busqueda.length > 1 ? 'Sin resultados para Â«' + busqueda + 'Â»' : 'Sin recursos aÃºn'"></p>
              <p class="text-sm text-gray-400 mt-1 mb-4"
                x-text="busqueda.length > 1 ? 'Prueba con otra bÃºsqueda' : 'Agrega el primer recurso a esta secciÃ³n'"></p>
              <div class="flex gap-3">
                <button x-show="busqueda.length > 1" @click="busqueda=''" class="btn-ghost border border-gray-200 dark:border-gray-700">Ver todos</button>
                <button x-show="busqueda.length <= 1" @click="abrirModalRecurso(seccion.id)" class="btn-primary">Agregar recurso</button>
              </div>
            </div>
          </div>
        </div>
      </template>

    </main>
  </div>
</div>

</body>
</html>
